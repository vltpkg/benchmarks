name: Package Manager Benchmarks
on: 
  push:
  workflow_dispatch:

jobs:
  benchmark:
    name: 'Benchmark'
    
    env: 
      COREPACK_ENABLE_STRICT: 0
      COREPACK_ENABLE_AUTO_PIN: 0
      YARN_ENABLE_IMMUTABLE_INSTALLS: false

    strategy:
      fail-fast: false
      matrix:
        platform:

          - name: Linux
            os: ubuntu-latest
            shell: bash
        
          # - name: macOS
          #   os: macos-latest
          #   shell: bash
        
          # - name: Windows
          #   os: windows-latest
          #   shell: cmd

    runs-on: ${{ matrix.platform.os }}
    
    steps:
    
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Install Node.js
        uses: actions/setup-node@v2
        with:
          node-version: '22'

      - name: Install Tooling
        run: |
          cargo install hyperfine --quiet
          npm install -g npm@latest vlt@latest bun@latest deno-bin@latest
          corepack enable yarn pnpm
      
      - name: Get Versions
        run: |
          echo "npm $(npm -v)"
          echo "vlt $(vlt -v)"
          echo "yarn $(corepack yarn@1 -v)"
          echo "yarn $(corepack yarn@latest -v)"
          echo "pnpm $(corepack pnpm@latest -v)"
          echo "bun $(bun -v)"
          echo "$(deno -v)"

      - name: Next Benchmarks
        uses: ./.github/workflows/run.yaml
        with:
          LOCATION: next
      
      - name: Astro Benchmarks
        uses: ./.github/workflows/run.yaml
        with:
          LOCATION: astro
      
      - name: Svelte Benchmarks
        uses: ./.github/workflows/run.yaml
        with:
          LOCATION: svelte

      - name: Vue Benchmarks
        uses: ./.github/workflows/run.yaml
        with:
          LOCATION: vue
